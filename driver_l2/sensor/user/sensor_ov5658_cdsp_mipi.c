/**************************************************************************
 *                                                                        *
 *         Copyright (c) 2014 by Generalplus Inc.                         *
 *                                                                        *
 *  This software is copyrighted by and is the property of Generalplus    *
 *  Inc. All rights are reserved by Generalplus Inc.                      *
 *  This software may only be used in accordance with the                 *
 *  corresponding license agreement. Any unauthorized use, duplication,   *
 *  distribution, or disclosure of this software is expressly forbidden.  *
 *                                                                        *
 *  This Copyright notice MUST not be removed or modified without prior   *
 *  written consent of Generalplus Technology Co., Ltd.                   *
 *                                                                        *
 *  Generalplus Inc. reserves the right to modify this software           *
 *  without notice.                                                       *
 *                                                                        *
 *  Generalplus Inc.                                                      *
 *  No.19, Industry E. Rd. IV, Hsinchu Science Park                       *
 *  Hsinchu City 30078, Taiwan, R.O.C.                                    *
 *                                                                        *
 **************************************************************************/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "drv_l1_sfr.h"
#include "drv_l1_csi.h"
#include "drv_l1_mipi.h"
#include "drv_l1_i2c.h"
#include "drv_l1_gpio.h"
#include "drv_l2_sensor.h"
#include "drv_l2_sccb.h"
#include "drv_l2_cdsp.h"



#if (defined _SENSOR_OV5658_CDSP_MIPI) && (_SENSOR_OV5658_CDSP_MIPI == 1)
#include "drv_l2_user_preference.h"
#include "drv_l2_user_calibration.h"
/**************************************************************************
 *                           C O N S T A N T S                            *
 **************************************************************************/
#define CONFIG_FPGA_TEST        0
#define COLOR_BAR_EN            0
#define MIPI_ISR_TEST           1
#define MIPI_LANE_NO			2	        // 1 or 2 lane
#define MIPI_DEV_NO             0           //0:MIPI_0 or 1:MIPI_1
// please modify I2C speed more than 100 KHz
#define	OV5658_ID						0x6C //0x20// 0x6C
#define OV5658_WIDTH				    2560// (2560)  -->MIPI RX input
#define OV5658_HEIGHT				    1944-8// (1920-8)

#define OV5658_OUT_WIDTH				2560 //--->CDSP YUV output
#define OV5658_OUT_HEIGHT				1944-16


#define OV5658_25FPS_50HZ_DAY_EV_IDX 			146
#define OV5658_25FPS_50HZ_NIGHT_EV_IDX			190
#define OV5658_25FPS_50HZ_EXP_TIME_TOTAL		249
#define OV5658_25FPS_50HZ_INIT_EV_IDX 			((OV5658_25FPS_50HZ_DAY_EV_IDX + OV5658_25FPS_50HZ_NIGHT_EV_IDX) >> 1)
#define OV5658_25FPS_50HZ_MAX_EV_IDX			  (OV5658_25FPS_50HZ_EXP_TIME_TOTAL - 12)




#define OV5658_25FPS_60HZ_DAY_EV_IDX 			146
#define OV5658_25FPS_60HZ_NIGHT_EV_IDX			190
#define OV5658_25FPS_60HZ_EXP_TIME_TOTAL		252
#define OV5658_25FPS_60HZ_INIT_EV_IDX 			((OV5658_25FPS_60HZ_DAY_EV_IDX + OV5658_25FPS_60HZ_NIGHT_EV_IDX) >> 1)
#define OV5658_25FPS_60HZ_MAX_EV_IDX			(OV5658_25FPS_60HZ_EXP_TIME_TOTAL - 12)
/*
#define OV5658_30FPS_50HZ_DAY_EV_IDX 			132
#define OV5658_30FPS_50HZ_NIGHT_EV_IDX			178
#define OV5658_30FPS_50HZ_EXP_TIME_TOTAL		246
#define OV5658_30FPS_50HZ_INIT_EV_IDX 			180//((OV5658_30FPS_50HZ_DAY_EV_IDX + OV5658_30FPS_50HZ_NIGHT_EV_IDX) >> 1)
#define OV5658_30FPS_50HZ_MAX_EV_IDX			(OV5658_30FPS_50HZ_EXP_TIME_TOTAL - 10)


#define OV5658_30FPS_60HZ_DAY_EV_IDX 			132
#define OV5658_30FPS_60HZ_NIGHT_EV_IDX			178
#define OV5658_30FPS_60HZ_EXP_TIME_TOTAL		    249
#define OV5658_30FPS_60HZ_INIT_EV_IDX 			180//((OV5658_30FPS_60HZ_DAY_EV_IDX + OV5658_30FPS_60HZ_NIGHT_EV_IDX) >> 1)
#define OV5658_30FPS_60HZ_MAX_EV_IDX			    (OV5658_30FPS_60HZ_EXP_TIME_TOTAL - 10)


#define OV5658_24FPS_50HZ_DAY_EV_IDX 			138
#define OV5658_24FPS_50HZ_NIGHT_EV_IDX			194
#define OV5658_24FPS_50HZ_EXP_TIME_TOTAL		    254
#define OV5658_24FPS_50HZ_INIT_EV_IDX 			((OV5658_24FPS_50HZ_DAY_EV_IDX + OV5658_24FPS_50HZ_NIGHT_EV_IDX) >> 1)
#define OV5658_24FPS_50HZ_MAX_EV_IDX			    (OV5658_24FPS_50HZ_EXP_TIME_TOTAL - 10)


#define OV5658_24FPS_60HZ_DAY_EV_IDX 			135
#define OV5658_24FPS_60HZ_NIGHT_EV_IDX			195
#define OV5658_24FPS_60HZ_EXP_TIME_TOTAL		    255
#define OV5658_24FPS_60HZ_INIT_EV_IDX 			((OV5658_24FPS_60HZ_DAY_EV_IDX + OV5658_24FPS_60HZ_NIGHT_EV_IDX) >> 1)
#define OV5658_24FPS_60HZ_MAX_EV_IDX			    (OV5658_24FPS_60HZ_EXP_TIME_TOTAL - 10)

*/


/**************************************************************************
 *                              M A C R O S                               *
 **************************************************************************/

/**************************************************************************
 *                          D A T A    T Y P E S                          *
 **************************************************************************/
typedef struct regval16_s
{
	INT16U reg_num;
	INT8U value;
} regval16_t;

/**************************************************************************
 *                         G L O B A L    D A T A                         *
 **************************************************************************/
static int ob_cnt = 0;
static int *p_expTime_table;
static sensor_exposure_t 	seInfo;
static int pre_sensor_a_gain, pre_sensor_time;


#if SCCB_MODE == SCCB_GPIO
	static void *ov5658_handle;
#elif SCCB_MODE == SCCB_HW_I2C
	static drv_l1_i2c_bus_handle_t ov5658_handle;
#endif

static mipi_config_t ov5658_mipi_cfg =
{
	DISABLE, 			/* low power, 0:disable, 1:enable */

#if MIPI_LANE_NO == 1
	D_PHY_SAMPLE_NEG, 	/* byte clock edge, 0:posedge, 1:negedge */
	MIPI_1_LANE,		/* lane */
	GENERATE_PIXEL_CLK,	/* byte clock source */
#elif MIPI_LANE_NO == 2
	D_PHY_SAMPLE_POS,
	MIPI_2_LANE,		/* lane */
	GENERATE_PIXEL_CLK,	/* byte clock source */
#endif

	MIPI_AUTO_DETECT,	/* data mode, 0:auto detect, 1:user define */
	MIPI_RAW10,			/* data type, valid when data mode is 1*/
	MIPI_DATA_TO_CDSP,	/* data type, 1:data[7:0]+2':00 to cdsp, 0: 2'00+data[7:0] to csi */
	0,				/* RSD 2 */

	OV5658_WIDTH,		/* width, 0~0xFFFF */
	OV5658_HEIGHT,		/* height, 0~0xFFFF */
	4, 					/* back porch, 0~0xF */
	4,					/* front porch, 0~0xF */
	ENABLE,				/* blanking_line_en, 0:disable, 1:enable */
	0,				/* RSD 3 */

	ENABLE,				/* ecc, 0:disable, 1:enable */
	MIPI_ECC_ORDER3,	/* ecc order */
	145, //200,				/* data mask, unit is ns ; mask_count = ns *193.5/1000 */
	MIPI_CHECK_HS_SEQ	/* check hs sequence or LP00 for clock lane */
};



// 2592x1944
const regval16_t ov5658_Mipi_Raw10_5M_25fps[] =
{
     {0x0103,  0x01},
     {0xffff,  0xff},
     {0x3210,  0x43},
     {0x3001,  0x0e},
     {0x3002,  0xc0},
     {0x3011,  0x21},
     {0x3012,  0x0a},
     {0x3013,  0x50},
     {0x3015,  0x09},
     {0x3018,  0xf0},
     {0x3021,  0x40},  //0x40}, //0x60},
     {0x3500,  0x00},
     {0x3501,  0x7b},
     {0x3502,  0x00},
     {0x3503,  0x07},
     {0x3505,  0x00},
     {0x3506,  0x00},
     {0x3507,  0x02},
     {0x3508,  0x00},
     {0x3509,  0x10},   //20
     {0x350a,  0x00},
     {0x350b,  0x10}, //0x80
     //{0x3600,  0x69},  //30fps or 15fps
     {0x3600,  0x58},  //25fps
     //{0x3600,  0x46},  //20fps
     //{0x3600,  0x6e},  //12.5fps
     //{0x3601,  0x23},  //15fps
     //{0x3601,  0x23},  //12.5fps
     {0x3602,  0x3c},
     {0x3605,  0x14},
     {0x3606,  0x09},
     {0x3612,  0x04},
     {0x3613,  0x66},
     {0x3614,  0x39},
     {0x3615,  0x33},
     {0x3616,  0x46},
     {0x361a,  0x0a},
     {0x361c,  0x76},
     {0x3620,  0x40},
     {0x3640,  0x03},
     {0x3641,  0x60},
     {0x3642,  0x00},
     {0x3643,  0x90},
     {0x3660,  0x04},  //40
     {0x3665,  0x00},
     {0x3666,  0x20},
     {0x3667,  0x00},
     {0x366a,  0x80},
     {0x3680,  0xe0},
     {0x3692,  0x80},
     {0x3700,  0x42},
     {0x3701,  0x14},
     {0x3702,  0xe8},
     {0x3703,  0x20},
     {0x3704,  0x5e},
     {0x3705,  0x02},
     {0x3708,  0xe3},
     {0x3709,  0xc3},
     {0x370a,  0x00},
     {0x370b,  0x20},
     {0x370c,  0x0c},
     {0x370d,  0x11},
     {0x370e,  0x00},
     {0x370f,  0x40},    //m60
     {0x3710,  0x00},
     {0x3715,  0x09},
     {0x371a,  0x04},
     {0x371b,  0x05},
     {0x371c,  0x01},
     {0x371e,  0xa1},
     {0x371f,  0x18},
     {0x3721,  0x00},
     {0x3726,  0x00},
     {0x372a,  0x01},
     {0x3730,  0x10},
     {0x3738,  0x22},
     {0x3739,  0xe5},
     {0x373a,  0x50},
     {0x373b,  0x02},
     {0x373c,  0x2c},
     {0x373f,  0x02},
     {0x3740,  0x42},
     {0x3741,  0x02},
     {0x3743,  0x01},   //m80
     {0x3744,  0x02},
     {0x3747,  0x00},
     {0x3754,  0xc0},
     {0x3755,  0x07},
     {0x3756,  0x1a},
     {0x3759,  0x0f},
     {0x375c,  0x04},
     {0x3767,  0x00},
     {0x376b,  0x44},
     {0x377b,  0x44},
     {0x377c,  0x30},
     {0x377e,  0x30},
     {0x377f,  0x08},
     {0x3781,  0x0c},
     {0x3785,  0x1e},
     {0x378f,  0xf5},
     {0x3791,  0xb0},
     {0x379c,  0x0c},
     {0x379d,  0x20},   //m100
     {0x379e,  0x00},
     {0x3796,  0x72},
     {0x379a,  0x07},
     {0x379b,  0xb0},
     {0x37c5,  0x00},
     {0x37c6,  0x00},
     {0x37c7,  0x00},
     {0x37c9,  0x00},
     {0x37ca,  0x00},
     {0x37cb,  0x00},
     {0x37cc,  0x00},
     {0x37cd,  0x00},
     {0x37ce,  0x01},
     {0x37cf,  0x00},
     {0x37d1,  0x00},
     {0x37de,  0x00},
     {0x37df,  0x00},
     {0x3800,  0x00},
     {0x3801,  0x00},   //m120
     {0x3802,  0x00},
     {0x3803,  0x00},
     {0x3804,  0x0a},   //IN-HsizeH
     {0x3805,  0x3f},//0x00},   //IN-HsizeL
     {0x3806,  0x07},   //IN-VsizeH
     {0x3807,  0xa3},//0x80},   //IN-VsizeL
     {0x3808,  0x0a},   //out-HsizeH
     {0x3809,  0x20},//0x00},   //out-HsizeL
     {0x380a,  0x07},   //out-VsizeH
     {0x380b,  0x98}, //0x20},//0x80},   //out-VsizeL
     //{0x380c,  0x0c},  //HTSH  30fps
     {0x380c,  0x0f},   //HTSH 25fps
     //{0x380c,  0x12},   //HTSH 20fps
     //{0x380c,  0x19},   //HTSH 15fps
     //{0x380c,  0x1e},   //HTSH 12.5fps
     //{0x380d,  0x98},   //HTSL 30fps
     {0x380d,  0x1c},    //HTSL 25fps
     //{0x380d,  0xe4},    //HTSL 20fps
     //{0x380d,  0x30},    //HTSL 15fps
     //{0x380d,  0x40},    //HTSL 12.5fps
     {0x380e,  0x07},   //VTSH
     {0x380f,  0xc0}, //0x90},//0xc0},//0x90},   //VTSL
     {0x3810,  0x00},
     {0x3811,  0x18},
     {0x3812,  0x00},
     {0x3813,  0x07},
     {0x3814,  0x11},
     {0x3815,  0x11},   //m140
     {0x3820,  0x10},
     {0x3821,  0x1e},
     {0x3823,  0x00},
     {0x3824,  0x00},
     {0x3825,  0x00},
     {0x3826,  0x00},
     {0x3827,  0x00},
     {0x3829,  0x0b},
     {0x382a,  0x04},
     {0x382c,  0x34},
     {0x382d,  0x00},
     {0x3a04,  0x06},
     {0x3a05,  0x14},
     {0x3a06,  0x00},
     {0x3a07,  0xfe},
     {0x3b00,  0x00},
     {0x3b02,  0x00},
     {0x3b03,  0x00},
     {0x3b04,  0x00},
     {0x3b05,  0x00},   //m160
     {0x4000,  0x18},
     {0x4001,  0x04},
     {0x4002,  0x45},
     {0x4004,  0x04},
     {0x4005,  0x18},
     {0x4006,  0x20},
     {0x4007,  0x98},
     {0x4008,  0x24},
     {0x4009,  0x10},
     {0x400c,  0x00},
     {0x400d,  0x00},
     {0x404e,  0x37},
     {0x404f,  0x8f},
     {0x4058,  0x00},
     {0x4100,  0x50},
     {0x4101,  0x34},
     {0x4102,  0x34},
     {0x4104,  0xde},
     {0x4300,  0xff},
     {0x4307,  0x30},   //m180
     {0x4311,  0x04},
     {0x4315,  0x01},
     {0x4501,  0x08},
     {0x4502,  0x08},
//     {0x4800,  0x24},
     {0x4816,  0x52},
     {0x481f,  0x30},
     {0x4826,  0x38},
//     {0x4825,  0x42},
//     {0x4829,  0x64},
     //{0x4837,  0x0a},  //30fps
     {0x4837,  0x0b},  //25fps
     //{0x4837,  0x0e},  //20fps
     //{0x4837,  0x13},  //15fps
     //{0x4837,  0x15},  //12.5fps
     {0x4a00,  0xaa},
     {0x4a02,  0x00},
     {0x4a03,  0x01},
     {0x4a05,  0x40},
     {0x4a0a,  0x88},
     {0x5000,  0x06},
     {0x5001,  0x01},
     {0x5002,  0x00},
     {0x5003,  0x20},
     {0x5013,  0x00},
     {0x501f,  0x00},
     {0x5043,  0x48},     //m200
     {0x5780,  0x1c},
     {0x5786,  0x20},
     {0x5788,  0x18},
     {0x578a,  0x04},
     {0x578b,  0x02},
     {0x578c,  0x02},
     {0x578e,  0x06},
     {0x578f,  0x02},
     {0x5790,  0x02},
     {0x5791,  0xff},
     {0x5e00,  0x00},  //color bar enable[7]
     {0x5e10,  0x0c},
     {0x0100,  0x01},

//     {0xFFFF,  0xFF},
//c8,  0x0001,  0xf2},
//c8,  0x000c,  0x02},
//c8,  0x000c,  0x00},
//c8,  0x0020,  0x12},
//c8,  0x0030,  0x00},
     {0x5800,  0x22},
     {0x5801,  0x11},
     {0x5802,  0x0d},
     {0x5803,  0x0d},
     {0x5804,  0x12},
     {0x5805,  0x26},
     {0x5806,  0x09},
     {0x5807,  0x07},    //m220
     {0x5808,  0x05},
     {0x5809,  0x05},
     {0x580a,  0x07},
     {0x580b,  0x0a},
     {0x580c,  0x07},
     {0x580d,  0x02},
     {0x580e,  0x00},
     {0x580f,  0x00},
     {0x5810,  0x03},
     {0x5811,  0x07},
     {0x5812,  0x06},
     {0x5813,  0x02},
     {0x5814,  0x00},
     {0x5815,  0x00},
     {0x5816,  0x03},
     {0x5817,  0x07},
     {0x5818,  0x09},
     {0x5819,  0x05},
     {0x581a,  0x04},
     {0x581b,  0x04},   //m240
     {0x581c,  0x07},
     {0x581d,  0x09},
     {0x581e,  0x1d},
     {0x581f,  0x0e},
     {0x5820,  0x0b},
     {0x5821,  0x0b},
     {0x5822,  0x0f},
     {0x5823,  0x1e},
     {0x5824,  0x59},
     {0x5825,  0x46},
     {0x5826,  0x37},
     {0x5827,  0x36},
     {0x5828,  0x45},
     {0x5829,  0x39},
     {0x582a,  0x46},
     {0x582b,  0x44},
     {0x582c,  0x45},
     {0x582d,  0x28},
     {0x582e,  0x38},   //m260
     {0x582f,  0x52},
     {0x5830,  0x60},
     {0x5831,  0x51},
     {0x5832,  0x26},
     {0x5833,  0x38},
     {0x5834,  0x43},
     {0x5835,  0x42},
     {0x5836,  0x34},
     {0x5837,  0x18},
     {0x5838,  0x05},
     {0x5839,  0x27},
     {0x583a,  0x27},
     {0x583b,  0x27},
     {0x583c,  0x0a},
     {0x583d,  0xbf},
     {0x5842,  0x01},
     {0x5843,  0x2b},
     {0x5844,  0x01},
     {0x5845,  0x92},   //m280
     {0x5846,  0x01},
     {0x5847,  0x8f},
     {0x5848,  0x01},
     {0x5849,  0x0c},
     {0x0100,  0x00},
     {0xFFFF,  0xFF},
     {0x0100,  0x01},
  	 {0x0000,  0x00}      //m287
};


const regval16_t ov5658_Mipi_Raw10_5M_20fps[] =
{
     {0x0103,  0x01},
     {0xffff,  0xff},
     {0x3210,  0x43},
     {0x3001,  0x0e},
     {0x3002,  0xc0},
     {0x3011,  0x21},
     {0x3012,  0x0a},
     {0x3013,  0x50},
     {0x3015,  0x09},
     {0x3018,  0xf0},
     {0x3021,  0x60},  //0x40}, //0x60},
     {0x3500,  0x00},
     {0x3501,  0x7b},
     {0x3502,  0x00},
     {0x3503,  0x07},
     {0x3505,  0x00},
     {0x3506,  0x00},
     {0x3507,  0x02},
     {0x3508,  0x00},
     {0x3509,  0x10},   //20
     {0x350a,  0x00},
     {0x350b,  0x10}, //0x80
     //{0x3600,  0x69},  //30fps or 15fps
     //{0x3600,  0x58},  //25fps
     {0x3600,  0x46},  //20fps
     //{0x3600,  0x6e},  //12.5fps
     //{0x3601,  0x23},  //15fps
     //{0x3601,  0x23},  //12.5fps
     {0x3602,  0x3c},
     {0x3605,  0x14},
     {0x3606,  0x09},
     {0x3612,  0x04},
     {0x3613,  0x66},
     {0x3614,  0x39},
     {0x3615,  0x33},
     {0x3616,  0x46},
     {0x361a,  0x0a},
     {0x361c,  0x76},
     {0x3620,  0x40},
     {0x3640,  0x03},
     {0x3641,  0x60},
     {0x3642,  0x00},
     {0x3643,  0x90},
     {0x3660,  0x04},  //40
     {0x3665,  0x00},
     {0x3666,  0x20},
     {0x3667,  0x00},
     {0x366a,  0x80},
     {0x3680,  0xe0},
     {0x3692,  0x80},
     {0x3700,  0x42},
     {0x3701,  0x14},
     {0x3702,  0xe8},
     {0x3703,  0x20},
     {0x3704,  0x5e},
     {0x3705,  0x02},
     {0x3708,  0xe3},
     {0x3709,  0xc3},
     {0x370a,  0x00},
     {0x370b,  0x20},
     {0x370c,  0x0c},
     {0x370d,  0x11},
     {0x370e,  0x00},
     {0x370f,  0x40},    //m60
     {0x3710,  0x00},
     {0x3715,  0x09},
     {0x371a,  0x04},
     {0x371b,  0x05},
     {0x371c,  0x01},
     {0x371e,  0xa1},
     {0x371f,  0x18},
     {0x3721,  0x00},
     {0x3726,  0x00},
     {0x372a,  0x01},
     {0x3730,  0x10},
     {0x3738,  0x22},
     {0x3739,  0xe5},
     {0x373a,  0x50},
     {0x373b,  0x02},
     {0x373c,  0x2c},
     {0x373f,  0x02},
     {0x3740,  0x42},
     {0x3741,  0x02},
     {0x3743,  0x01},   //m80
     {0x3744,  0x02},
     {0x3747,  0x00},
     {0x3754,  0xc0},
     {0x3755,  0x07},
     {0x3756,  0x1a},
     {0x3759,  0x0f},
     {0x375c,  0x04},
     {0x3767,  0x00},
     {0x376b,  0x44},
     {0x377b,  0x44},
     {0x377c,  0x30},
     {0x377e,  0x30},
     {0x377f,  0x08},
     {0x3781,  0x0c},
     {0x3785,  0x1e},
     {0x378f,  0xf5},
     {0x3791,  0xb0},
     {0x379c,  0x0c},
     {0x379d,  0x20},   //m100
     {0x379e,  0x00},
     {0x3796,  0x72},
     {0x379a,  0x07},
     {0x379b,  0xb0},
     {0x37c5,  0x00},
     {0x37c6,  0x00},
     {0x37c7,  0x00},
     {0x37c9,  0x00},
     {0x37ca,  0x00},
     {0x37cb,  0x00},
     {0x37cc,  0x00},
     {0x37cd,  0x00},
     {0x37ce,  0x01},
     {0x37cf,  0x00},
     {0x37d1,  0x00},
     {0x37de,  0x00},
     {0x37df,  0x00},
     {0x3800,  0x00},
     {0x3801,  0x00},   //m120
     {0x3802,  0x00},
     {0x3803,  0x00},
     {0x3804,  0x0a},   //IN-HsizeH
     {0x3805,  0x3f},//0x00},   //IN-HsizeL
     {0x3806,  0x07},   //IN-VsizeH
     {0x3807,  0xa3},//0x80},   //IN-VsizeL
     {0x3808,  0x0a},   //out-HsizeH
     {0x3809,  0x20},//0x00},   //out-HsizeL
     {0x380a,  0x07},   //out-VsizeH
     {0x380b,  0x98}, //0x20},//0x80},   //out-VsizeL
     //{0x380c,  0x0c},  //HTSH  30fps
     //{0x380c,  0x0f},   //HTSH 25fps
     {0x380c,  0x12},   //HTSH 20fps
     //{0x380c,  0x19},   //HTSH 15fps
     //{0x380c,  0x1e},   //HTSH 12.5fps
     //{0x380d,  0x98},   //HTSL 30fps
     //{0x380d,  0x1c},    //HTSL 25fps
     {0x380d,  0xe4},    //HTSL 20fps
     //{0x380d,  0x30},    //HTSL 15fps
     //{0x380d,  0x40},    //HTSL 12.5fps
     {0x380e,  0x07},   //VTSH
     {0x380f,  0xc0}, //0x90},//0xc0},//0x90},   //VTSL
     {0x3810,  0x00},
     {0x3811,  0x18},
     {0x3812,  0x00},
     {0x3813,  0x07},
     {0x3814,  0x11},
     {0x3815,  0x11},   //m140
     {0x3820,  0x10},
     {0x3821,  0x1e},
     {0x3823,  0x00},
     {0x3824,  0x00},
     {0x3825,  0x00},
     {0x3826,  0x00},
     {0x3827,  0x00},
     {0x3829,  0x0b},
     {0x382a,  0x04},
     {0x382c,  0x34},
     {0x382d,  0x00},
     {0x3a04,  0x06},
     {0x3a05,  0x14},
     {0x3a06,  0x00},
     {0x3a07,  0xfe},
     {0x3b00,  0x00},
     {0x3b02,  0x00},
     {0x3b03,  0x00},
     {0x3b04,  0x00},
     {0x3b05,  0x00},   //m160
     {0x4000,  0x18},
     {0x4001,  0x04},
     {0x4002,  0x45},
     {0x4004,  0x04},
     {0x4005,  0x18},
     {0x4006,  0x20},
     {0x4007,  0x98},
     {0x4008,  0x24},
     {0x4009,  0x10},
     {0x400c,  0x00},
     {0x400d,  0x00},
     {0x404e,  0x37},
     {0x404f,  0x8f},
     {0x4058,  0x00},
     {0x4100,  0x50},
     {0x4101,  0x34},
     {0x4102,  0x34},
     {0x4104,  0xde},
     {0x4300,  0xff},
     {0x4307,  0x30},   //m180
     {0x4311,  0x04},
     {0x4315,  0x01},
     {0x4501,  0x08},
     {0x4502,  0x08},
     {0x4816,  0x52},
     {0x481f,  0x30},
     {0x4826,  0x38},
     //{0x4837,  0x0a},  //30fps
     //{0x4837,  0x0b},  //25fps
     {0x4837,  0x0e},  //20fps
     //{0x4837,  0x13},  //15fps
     //{0x4837,  0x15},  //12.5fps
     {0x4a00,  0xaa},
     {0x4a02,  0x00},
     {0x4a03,  0x01},
     {0x4a05,  0x40},
     {0x4a0a,  0x88},
     {0x5000,  0x06},
     {0x5001,  0x01},
     {0x5002,  0x00},
     {0x5003,  0x20},
     {0x5013,  0x00},
     {0x501f,  0x00},
     {0x5043,  0x48},     //m200
     {0x5780,  0x1c},
     {0x5786,  0x20},
     {0x5788,  0x18},
     {0x578a,  0x04},
     {0x578b,  0x02},
     {0x578c,  0x02},
     {0x578e,  0x06},
     {0x578f,  0x02},
     {0x5790,  0x02},
     {0x5791,  0xff},
     {0x5e00,  0x00},  //color bar enable[7]
     {0x5e10,  0x0c},
     {0x0100,  0x01},

//     {0xFFFF,  0xFF},
//c8,  0x0001,  0xf2},
//c8,  0x000c,  0x02},
//c8,  0x000c,  0x00},
//c8,  0x0020,  0x12},
//c8,  0x0030,  0x00},
     {0x5800,  0x22},
     {0x5801,  0x11},
     {0x5802,  0x0d},
     {0x5803,  0x0d},
     {0x5804,  0x12},
     {0x5805,  0x26},
     {0x5806,  0x09},
     {0x5807,  0x07},    //m220
     {0x5808,  0x05},
     {0x5809,  0x05},
     {0x580a,  0x07},
     {0x580b,  0x0a},
     {0x580c,  0x07},
     {0x580d,  0x02},
     {0x580e,  0x00},
     {0x580f,  0x00},
     {0x5810,  0x03},
     {0x5811,  0x07},
     {0x5812,  0x06},
     {0x5813,  0x02},
     {0x5814,  0x00},
     {0x5815,  0x00},
     {0x5816,  0x03},
     {0x5817,  0x07},
     {0x5818,  0x09},
     {0x5819,  0x05},
     {0x581a,  0x04},
     {0x581b,  0x04},   //m240
     {0x581c,  0x07},
     {0x581d,  0x09},
     {0x581e,  0x1d},
     {0x581f,  0x0e},
     {0x5820,  0x0b},
     {0x5821,  0x0b},
     {0x5822,  0x0f},
     {0x5823,  0x1e},
     {0x5824,  0x59},
     {0x5825,  0x46},
     {0x5826,  0x37},
     {0x5827,  0x36},
     {0x5828,  0x45},
     {0x5829,  0x39},
     {0x582a,  0x46},
     {0x582b,  0x44},
     {0x582c,  0x45},
     {0x582d,  0x28},
     {0x582e,  0x38},   //m260
     {0x582f,  0x52},
     {0x5830,  0x60},
     {0x5831,  0x51},
     {0x5832,  0x26},
     {0x5833,  0x38},
     {0x5834,  0x43},
     {0x5835,  0x42},
     {0x5836,  0x34},
     {0x5837,  0x18},
     {0x5838,  0x05},
     {0x5839,  0x27},
     {0x583a,  0x27},
     {0x583b,  0x27},
     {0x583c,  0x0a},
     {0x583d,  0xbf},
     {0x5842,  0x01},
     {0x5843,  0x2b},
     {0x5844,  0x01},
     {0x5845,  0x92},   //m280
     {0x5846,  0x01},
     {0x5847,  0x8f},
     {0x5848,  0x01},
     {0x5849,  0x0c},
//     {0x0100,  0x01},
  	 {0x0000,  0x00}      //m287
};

static const  int ov5658_mipi_25fps_exp_time_gain_60Hz[OV5658_25FPS_60HZ_EXP_TIME_TOTAL][3] =
{
{4, (int)(1.00*256), (int)(1.00*256)},
{5, (int)(1.00*256), (int)(1.00*256)},
{5, (int)(1.00*256), (int)(1.00*256)},
{5, (int)(1.00*256), (int)(1.00*256)},
{5, (int)(1.00*256), (int)(1.00*256)},
{5, (int)(1.00*256), (int)(1.00*256)},
{5, (int)(1.00*256), (int)(1.00*256)},
{6, (int)(1.00*256), (int)(1.00*256)},
{6, (int)(1.00*256), (int)(1.00*256)},
{6, (int)(1.00*256), (int)(1.00*256)},
{6, (int)(1.00*256), (int)(1.00*256)},
{6, (int)(1.00*256), (int)(1.00*256)},
{7, (int)(1.00*256), (int)(1.00*256)},
{7, (int)(1.00*256), (int)(1.00*256)},
{7, (int)(1.00*256), (int)(1.00*256)},
{7, (int)(1.00*256), (int)(1.00*256)},
{8, (int)(1.00*256), (int)(1.00*256)},
{8, (int)(1.00*256), (int)(1.00*256)},
{8, (int)(1.00*256), (int)(1.00*256)},
{9, (int)(1.00*256), (int)(1.00*256)},
{9, (int)(1.00*256), (int)(1.00*256)},
{9, (int)(1.00*256), (int)(1.00*256)},
{9, (int)(1.00*256), (int)(1.00*256)},
{10, (int)(1.00*256), (int)(1.00*256)},
{10, (int)(1.00*256), (int)(1.00*256)},
{10, (int)(1.00*256), (int)(1.00*256)},
{11, (int)(1.00*256), (int)(1.00*256)},
{11, (int)(1.00*256), (int)(1.00*256)},
{12, (int)(1.00*256), (int)(1.00*256)},
{12, (int)(1.00*256), (int)(1.00*256)},
{12, (int)(1.00*256), (int)(1.00*256)},
{13, (int)(1.00*256), (int)(1.00*256)},
{13, (int)(1.00*256), (int)(1.00*256)},
{14, (int)(1.00*256), (int)(1.00*256)},
{14, (int)(1.00*256), (int)(1.00*256)},
{15, (int)(1.00*256), (int)(1.00*256)},
{15, (int)(1.00*256), (int)(1.00*256)},
{16, (int)(1.00*256), (int)(1.00*256)},
{16, (int)(1.00*256), (int)(1.00*256)},
{17, (int)(1.00*256), (int)(1.00*256)},
{18, (int)(1.00*256), (int)(1.00*256)},
{18, (int)(1.00*256), (int)(1.00*256)},
{19, (int)(1.00*256), (int)(1.00*256)},
{20, (int)(1.00*256), (int)(1.00*256)},
{20, (int)(1.00*256), (int)(1.00*256)},
{21, (int)(1.00*256), (int)(1.00*256)},
{22, (int)(1.00*256), (int)(1.00*256)},
{22, (int)(1.00*256), (int)(1.00*256)},
{23, (int)(1.00*256), (int)(1.00*256)},
{24, (int)(1.00*256), (int)(1.00*256)},
{25, (int)(1.00*256), (int)(1.00*256)},
{26, (int)(1.00*256), (int)(1.00*256)},
{27, (int)(1.00*256), (int)(1.00*256)},
{28, (int)(1.00*256), (int)(1.00*256)},
{29, (int)(1.00*256), (int)(1.00*256)},
{30, (int)(1.00*256), (int)(1.00*256)},
{31, (int)(1.00*256), (int)(1.00*256)},
{32, (int)(1.00*256), (int)(1.00*256)},
{33, (int)(1.00*256), (int)(1.00*256)},
{34, (int)(1.00*256), (int)(1.00*256)},
{35, (int)(1.00*256), (int)(1.00*256)},
{37, (int)(1.00*256), (int)(1.00*256)},
{38, (int)(1.00*256), (int)(1.00*256)},
{39, (int)(1.00*256), (int)(1.00*256)},
{41, (int)(1.00*256), (int)(1.00*256)},
{42, (int)(1.00*256), (int)(1.00*256)},
{43, (int)(1.00*256), (int)(1.00*256)},
{45, (int)(1.00*256), (int)(1.00*256)},
{47, (int)(1.00*256), (int)(1.00*256)},
{48, (int)(1.00*256), (int)(1.00*256)},
{50, (int)(1.00*256), (int)(1.00*256)},
{52, (int)(1.00*256), (int)(1.00*256)},
{53, (int)(1.00*256), (int)(1.00*256)},
{55, (int)(1.00*256), (int)(1.00*256)},
{57, (int)(1.00*256), (int)(1.00*256)},
{59, (int)(1.00*256), (int)(1.00*256)},
{61, (int)(1.00*256), (int)(1.00*256)},
{64, (int)(1.00*256), (int)(1.00*256)},
{66, (int)(1.00*256), (int)(1.00*256)},
{68, (int)(1.00*256), (int)(1.00*256)},
{71, (int)(1.00*256), (int)(1.00*256)},
{73, (int)(1.00*256), (int)(1.00*256)},
{76, (int)(1.00*256), (int)(1.00*256)},
{78, (int)(1.00*256), (int)(1.00*256)},
{81, (int)(1.00*256), (int)(1.00*256)},
{84, (int)(1.00*256), (int)(1.00*256)},
{87, (int)(1.00*256), (int)(1.00*256)},
{90, (int)(1.00*256), (int)(1.00*256)},
{93, (int)(1.00*256), (int)(1.00*256)},
{96, (int)(1.00*256), (int)(1.00*256)},
{100, (int)(1.00*256), (int)(1.00*256)},
{103, (int)(1.00*256), (int)(1.00*256)},
{107, (int)(1.00*256), (int)(1.00*256)},
{111, (int)(1.00*256), (int)(1.00*256)},
{115, (int)(1.00*256), (int)(1.00*256)},
{119, (int)(1.00*256), (int)(1.00*256)},
{123, (int)(1.00*256), (int)(1.00*256)},
{127, (int)(1.00*256), (int)(1.00*256)},
{132, (int)(1.00*256), (int)(1.00*256)},
{136, (int)(1.00*256), (int)(1.00*256)},
{141, (int)(1.00*256), (int)(1.00*256)},
{146, (int)(1.00*256), (int)(1.00*256)},
{151, (int)(1.00*256), (int)(1.00*256)},
{156, (int)(1.00*256), (int)(1.00*256)},
{162, (int)(1.00*256), (int)(1.00*256)},
{168, (int)(1.00*256), (int)(1.00*256)},
{174, (int)(1.00*256), (int)(1.00*256)},
{180, (int)(1.00*256), (int)(1.00*256)},
{186, (int)(1.00*256), (int)(1.00*256)},
{193, (int)(1.00*256), (int)(1.00*256)},
{199, (int)(1.00*256), (int)(1.00*256)},
{207, (int)(1.00*256), (int)(1.00*256)},
{214, (int)(1.00*256), (int)(1.00*256)},
{221, (int)(1.00*256), (int)(1.00*256)},
{229, (int)(1.00*256), (int)(1.00*256)},
{237, (int)(1.00*256), (int)(1.00*256)},
{246, (int)(1.00*256), (int)(1.00*256)},
{254, (int)(1.00*256), (int)(1.00*256)},
{263, (int)(1.00*256), (int)(1.00*256)},
{272, (int)(1.00*256), (int)(1.00*256)},
{282, (int)(1.00*256), (int)(1.00*256)},
{292, (int)(1.00*256), (int)(1.00*256)},
{302, (int)(1.00*256), (int)(1.00*256)},
{313, (int)(1.00*256), (int)(1.00*256)},
{324, (int)(1.00*256), (int)(1.00*256)},
{335, (int)(1.00*256), (int)(1.00*256)},
{347, (int)(1.00*256), (int)(1.00*256)},
{360, (int)(1.00*256), (int)(1.00*256)},
{372, (int)(1.00*256), (int)(1.00*256)},
{385, (int)(1.00*256), (int)(1.00*256)},
{399, (int)(1.00*256), (int)(1.00*256)},
{413, (int)(1.00*256), (int)(1.00*256)},
{413, (int)(1.0625*256), (int)(1.00*256)},
{413, (int)(1.0625*256), (int)(1.00*256)},
{413, (int)(1.125*256), (int)(1.00*256)},
{413, (int)(1.125*256), (int)(1.00*256)},
{413, (int)(1.1875*256), (int)(1.00*256)},
{413, (int)(1.25*256), (int)(1.00*256)},
{413, (int)(1.25*256), (int)(1.00*256)},
{413, (int)(1.3125*256), (int)(1.00*256)},
{413, (int)(1.375*256), (int)(1.00*256)},
{413, (int)(1.4375*256), (int)(1.00*256)},
{413, (int)(1.4375*256), (int)(1.00*256)},
{413, (int)(1.5*256), (int)(1.00*256)},
{413, (int)(1.5625*256), (int)(1.00*256)},
{413, (int)(1.625*256), (int)(1.00*256)},
{413, (int)(1.6875*256), (int)(1.00*256)},
{413, (int)(1.75*256), (int)(1.00*256)},
{413, (int)(1.8125*256), (int)(1.00*256)},
{413, (int)(1.875*256), (int)(1.00*256)},
{413, (int)(1.9375*256), (int)(1.00*256)},
{827, (int)(1.00*256), (int)(1.00*256)},
{827, (int)(1.0625*256), (int)(1.00*256)},
{827, (int)(1.0625*256), (int)(1.00*256)},
{827, (int)(1.125*256), (int)(1.00*256)},
{827, (int)(1.125*256), (int)(1.00*256)},
{827, (int)(1.1875*256), (int)(1.00*256)},
{827, (int)(1.25*256), (int)(1.00*256)},
{827, (int)(1.25*256), (int)(1.00*256)},
{827, (int)(1.3125*256), (int)(1.00*256)},
{827, (int)(1.375*256), (int)(1.00*256)},
{827, (int)(1.4375*256), (int)(1.00*256)},
{827, (int)(1.4375*256), (int)(1.00*256)},
{827, (int)(1.5*256), (int)(1.00*256)},
{827, (int)(1.5625*256), (int)(1.00*256)},
{827, (int)(1.625*256), (int)(1.00*256)},
{827, (int)(1.6875*256), (int)(1.00*256)},
{827, (int)(1.75*256), (int)(1.00*256)},
{827, (int)(1.8125*256), (int)(1.00*256)},
{827, (int)(1.875*256), (int)(1.00*256)},
{827, (int)(1.9375*256), (int)(1.00*256)},
{1240, (int)(1.3125*256), (int)(1.00*256)},
{1240, (int)(1.375*256), (int)(1.00*256)},
{1240, (int)(1.4375*256), (int)(1.00*256)},
{1240, (int)(1.4375*256), (int)(1.00*256)},
{1240, (int)(1.5*256), (int)(1.00*256)},
{1240, (int)(1.5625*256), (int)(1.00*256)},
{1240, (int)(1.625*256), (int)(1.00*256)},
{1240, (int)(1.6875*256), (int)(1.00*256)},
{1240, (int)(1.75*256), (int)(1.00*256)},
{1240, (int)(1.8125*256), (int)(1.00*256)},
{1240, (int)(1.875*256), (int)(1.00*256)},
{1240, (int)(1.9375*256), (int)(1.00*256)},
{1653, (int)(1.5*256), (int)(1.00*256)},
{1653, (int)(1.5625*256), (int)(1.00*256)},
{1653, (int)(1.625*256), (int)(1.00*256)},
{1653, (int)(1.6875*256), (int)(1.00*256)},
{1653, (int)(1.75*256), (int)(1.00*256)},
{1653, (int)(1.8125*256), (int)(1.00*256)},
{1653, (int)(1.875*256), (int)(1.00*256)},
{1653, (int)(1.9375*256), (int)(1.00*256)},
{1653, (int)(2.0*256), (int)(1.00*256)},
{1653, (int)(2.07*256), (int)(1.00*256)},
{1653, (int)(2.14*256), (int)(1.00*256)},
{1653, (int)(2.22*256), (int)(1.00*256)},
{1653, (int)(2.30*256), (int)(1.00*256)},
{1653, (int)(2.38*256), (int)(1.00*256)},
{1653, (int)(2.46*256), (int)(1.00*256)},
{1653, (int)(2.55*256), (int)(1.00*256)},
{1653, (int)(2.64*256), (int)(1.00*256)},
{1653, (int)(2.73*256), (int)(1.00*256)},
{1653, (int)(2.83*256), (int)(1.00*256)},
{1653, (int)(2.93*256), (int)(1.00*256)},
{1653, (int)(3.03*256), (int)(1.00*256)},
{1653, (int)(3.14*256), (int)(1.00*256)},
{1653, (int)(3.25*256), (int)(1.00*256)},
{1653, (int)(3.36*256), (int)(1.00*256)},
{1653, (int)(3.48*256), (int)(1.00*256)},
{1653, (int)(3.61*256), (int)(1.00*256)},
{1653, (int)(3.73*256), (int)(1.00*256)},
{1653, (int)(3.86*256), (int)(1.00*256)},
{1653, (int)(4.00*256), (int)(1.00*256)},
{1653, (int)(4.14*256), (int)(1.00*256)},
{1653, (int)(4.29*256), (int)(1.00*256)},
{1653, (int)(4.44*256), (int)(1.00*256)},
{1653, (int)(4.59*256), (int)(1.00*256)},
{1653, (int)(4.76*256), (int)(1.00*256)},
{1653, (int)(4.92*256), (int)(1.00*256)},
{1653, (int)(5.10*256), (int)(1.00*256)},
{1653, (int)(5.28*256), (int)(1.00*256)},
{1653, (int)(5.46*256), (int)(1.00*256)},
{1653, (int)(5.66*256), (int)(1.00*256)},
{1653, (int)(5.86*256), (int)(1.00*256)},
{1653, (int)(6.06*256), (int)(1.00*256)},
{1653, (int)(6.28*256), (int)(1.00*256)},
{1653, (int)(6.50*256), (int)(1.00*256)},
{1653, (int)(6.73*256), (int)(1.00*256)},
{1653, (int)(6.96*256), (int)(1.00*256)},
{1653, (int)(7.21*256), (int)(1.00*256)},
{1653, (int)(7.46*256), (int)(1.00*256)},
{1653, (int)(7.73*256), (int)(1.00*256)},
{1653, (int)(8.00*256), (int)(1.00*256)},
{1653, (int)(8.28*256), (int)(1.00*256)},
{1653, (int)(8.57*256), (int)(1.00*256)},
{1653, (int)(8.88*256), (int)(1.00*256)},
{1653, (int)(9.19*256), (int)(1.00*256)},
{1653, (int)(9.51*256), (int)(1.00*256)},
{1653, (int)(9.85*256), (int)(1.00*256)},
{1653, (int)(10.20*256), (int)(1.00*256)},
{1653, (int)(10.56*256), (int)(1.00*256)},
{1653, (int)(10.93*256), (int)(1.00*256)},
{1653, (int)(11.31*256), (int)(1.00*256)},
{1653, (int)(11.71*256), (int)(1.00*256)},
{1653, (int)(12.13*256), (int)(1.00*256)},
{1653, (int)(12.55*256), (int)(1.00*256)},
{1653, (int)(13.00*256), (int)(1.00*256)},
{1653, (int)(13.45*256), (int)(1.00*256)},
{1653, (int)(13.93*256), (int)(1.00*256)},
{1653, (int)(14.42*256), (int)(1.00*256)},
{1653, (int)(14.93*256), (int)(1.00*256)},
{1653, (int)(15.45*256), (int)(1.00*256)},
{1653, (int)(16.00*256), (int)(1.00*256)}

};


static const  int ov5658_mipi_25fps_exp_time_gain_50Hz[OV5658_25FPS_50HZ_EXP_TIME_TOTAL][3] =
{
{4, (int)(1.00*256), (int)(1.00*256)},
{5, (int)(1.00*256), (int)(1.00*256)},
{5, (int)(1.00*256), (int)(1.00*256)},
{5, (int)(1.00*256), (int)(1.00*256)},
{5, (int)(1.00*256), (int)(1.00*256)},
{5, (int)(1.00*256), (int)(1.00*256)},
{5, (int)(1.00*256), (int)(1.00*256)},
{6, (int)(1.00*256), (int)(1.00*256)},
{6, (int)(1.00*256), (int)(1.00*256)},
{6, (int)(1.00*256), (int)(1.00*256)},
{6, (int)(1.00*256), (int)(1.00*256)},
{7, (int)(1.00*256), (int)(1.00*256)},
{7, (int)(1.00*256), (int)(1.00*256)},
{7, (int)(1.00*256), (int)(1.00*256)},
{7, (int)(1.00*256), (int)(1.00*256)},
{7, (int)(1.00*256), (int)(1.00*256)},
{8, (int)(1.00*256), (int)(1.00*256)},
{8, (int)(1.00*256), (int)(1.00*256)},
{8, (int)(1.00*256), (int)(1.00*256)},
{9, (int)(1.00*256), (int)(1.00*256)},
{9, (int)(1.00*256), (int)(1.00*256)},
{9, (int)(1.00*256), (int)(1.00*256)},
{10, (int)(1.00*256), (int)(1.00*256)},
{10, (int)(1.00*256), (int)(1.00*256)},
{10, (int)(1.00*256), (int)(1.00*256)},
{11, (int)(1.00*256), (int)(1.00*256)},
{11, (int)(1.00*256), (int)(1.00*256)},
{11, (int)(1.00*256), (int)(1.00*256)},
{12, (int)(1.00*256), (int)(1.00*256)},
{12, (int)(1.00*256), (int)(1.00*256)},
{13, (int)(1.00*256), (int)(1.00*256)},
{13, (int)(1.00*256), (int)(1.00*256)},
{13, (int)(1.00*256), (int)(1.00*256)},
{14, (int)(1.00*256), (int)(1.00*256)},
{14, (int)(1.00*256), (int)(1.00*256)},
{15, (int)(1.00*256), (int)(1.00*256)},
{16, (int)(1.00*256), (int)(1.00*256)},
{16, (int)(1.00*256), (int)(1.00*256)},
{17, (int)(1.00*256), (int)(1.00*256)},
{17, (int)(1.00*256), (int)(1.00*256)},
{18, (int)(1.00*256), (int)(1.00*256)},
{18, (int)(1.00*256), (int)(1.00*256)},
{19, (int)(1.00*256), (int)(1.00*256)},
{20, (int)(1.00*256), (int)(1.00*256)},
{20, (int)(1.00*256), (int)(1.00*256)},
{21, (int)(1.00*256), (int)(1.00*256)},
{22, (int)(1.00*256), (int)(1.00*256)},
{23, (int)(1.00*256), (int)(1.00*256)},
{23, (int)(1.00*256), (int)(1.00*256)},
{24, (int)(1.00*256), (int)(1.00*256)},
{25, (int)(1.00*256), (int)(1.00*256)},
{26, (int)(1.00*256), (int)(1.00*256)},
{27, (int)(1.00*256), (int)(1.00*256)},
{28, (int)(1.00*256), (int)(1.00*256)},
{29, (int)(1.00*256), (int)(1.00*256)},
{30, (int)(1.00*256), (int)(1.00*256)},
{31, (int)(1.00*256), (int)(1.00*256)},
{32, (int)(1.00*256), (int)(1.00*256)},
{33, (int)(1.00*256), (int)(1.00*256)},
{34, (int)(1.00*256), (int)(1.00*256)},
{36, (int)(1.00*256), (int)(1.00*256)},
{37, (int)(1.00*256), (int)(1.00*256)},
{38, (int)(1.00*256), (int)(1.00*256)},
{40, (int)(1.00*256), (int)(1.00*256)},
{41, (int)(1.00*256), (int)(1.00*256)},
{42, (int)(1.00*256), (int)(1.00*256)},
{44, (int)(1.00*256), (int)(1.00*256)},
{45, (int)(1.00*256), (int)(1.00*256)},
{47, (int)(1.00*256), (int)(1.00*256)},
{49, (int)(1.00*256), (int)(1.00*256)},
{50, (int)(1.00*256), (int)(1.00*256)},
{52, (int)(1.00*256), (int)(1.00*256)},
{54, (int)(1.00*256), (int)(1.00*256)},
{56, (int)(1.00*256), (int)(1.00*256)},
{58, (int)(1.00*256), (int)(1.00*256)},
{60, (int)(1.00*256), (int)(1.00*256)},
{62, (int)(1.00*256), (int)(1.00*256)},
{64, (int)(1.00*256), (int)(1.00*256)},
{66, (int)(1.00*256), (int)(1.00*256)},
{69, (int)(1.00*256), (int)(1.00*256)},
{71, (int)(1.00*256), (int)(1.00*256)},
{74, (int)(1.00*256), (int)(1.00*256)},
{76, (int)(1.00*256), (int)(1.00*256)},
{79, (int)(1.00*256), (int)(1.00*256)},
{82, (int)(1.00*256), (int)(1.00*256)},
{85, (int)(1.00*256), (int)(1.00*256)},
{88, (int)(1.00*256), (int)(1.00*256)},
{91, (int)(1.00*256), (int)(1.00*256)},
{94, (int)(1.00*256), (int)(1.00*256)},
{97, (int)(1.00*256), (int)(1.00*256)},
{101, (int)(1.00*256), (int)(1.00*256)},
{104, (int)(1.00*256), (int)(1.00*256)},
{108, (int)(1.00*256), (int)(1.00*256)},
{112, (int)(1.00*256), (int)(1.00*256)},
{116, (int)(1.00*256), (int)(1.00*256)},
{120, (int)(1.00*256), (int)(1.00*256)},
{124, (int)(1.00*256), (int)(1.00*256)},
{128, (int)(1.00*256), (int)(1.00*256)},
{133, (int)(1.00*256), (int)(1.00*256)},
{138, (int)(1.00*256), (int)(1.00*256)},
{142, (int)(1.00*256), (int)(1.00*256)},
{147, (int)(1.00*256), (int)(1.00*256)},
{153, (int)(1.00*256), (int)(1.00*256)},
{158, (int)(1.00*256), (int)(1.00*256)},
{164, (int)(1.00*256), (int)(1.00*256)},
{169, (int)(1.00*256), (int)(1.00*256)},
{175, (int)(1.00*256), (int)(1.00*256)},
{182, (int)(1.00*256), (int)(1.00*256)},
{188, (int)(1.00*256), (int)(1.00*256)},
{195, (int)(1.00*256), (int)(1.00*256)},
{201, (int)(1.00*256), (int)(1.00*256)},
{209, (int)(1.00*256), (int)(1.00*256)},
{216, (int)(1.00*256), (int)(1.00*256)},
{224, (int)(1.00*256), (int)(1.00*256)},
{231, (int)(1.00*256), (int)(1.00*256)},
{240, (int)(1.00*256), (int)(1.00*256)},
{248, (int)(1.00*256), (int)(1.00*256)},
{257, (int)(1.00*256), (int)(1.00*256)},
{266, (int)(1.00*256), (int)(1.00*256)},
{275, (int)(1.00*256), (int)(1.00*256)},
{285, (int)(1.00*256), (int)(1.00*256)},
{295, (int)(1.00*256), (int)(1.00*256)},
{305, (int)(1.00*256), (int)(1.00*256)},
{316, (int)(1.00*256), (int)(1.00*256)},
{327, (int)(1.00*256), (int)(1.00*256)},
{339, (int)(1.00*256), (int)(1.00*256)},
{351, (int)(1.00*256), (int)(1.00*256)},
{363, (int)(1.00*256), (int)(1.00*256)},
{376, (int)(1.00*256), (int)(1.00*256)},
{389, (int)(1.00*256), (int)(1.00*256)},
{403, (int)(1.00*256), (int)(1.00*256)},
{417, (int)(1.00*256), (int)(1.00*256)},
{432, (int)(1.00*256), (int)(1.00*256)},
{447, (int)(1.00*256), (int)(1.00*256)},
{463, (int)(1.00*256), (int)(1.00*256)},
{479, (int)(1.00*256), (int)(1.00*256)},
{496, (int)(1.00*256), (int)(1.00*256)},
{496, (int)(1.0625*256), (int)(1.00*256)},
{496, (int)(1.0625*256), (int)(1.00*256)},
{496, (int)(1.125*256), (int)(1.00*256)},
{496, (int)(1.125*256), (int)(1.00*256)},
{496, (int)(1.1875*256), (int)(1.00*256)},
{496, (int)(1.25*256), (int)(1.00*256)},
{496, (int)(1.25*256), (int)(1.00*256)},
{496, (int)(1.3125*256), (int)(1.00*256)},
{496, (int)(1.375*256), (int)(1.00*256)},
{496, (int)(1.4375*256), (int)(1.00*256)},
{496, (int)(1.4375*256), (int)(1.00*256)},
{496, (int)(1.5*256), (int)(1.00*256)},
{496, (int)(1.5625*256), (int)(1.00*256)},
{496, (int)(1.625*256), (int)(1.00*256)},
{496, (int)(1.6875*256), (int)(1.00*256)},
{496, (int)(1.75*256), (int)(1.00*256)},
{496, (int)(1.8125*256), (int)(1.00*256)},
{496, (int)(1.875*256), (int)(1.00*256)},
{496, (int)(1.9375*256), (int)(1.00*256)},
{992, (int)(1.00*256), (int)(1.00*256)},
{992, (int)(1.0625*256), (int)(1.00*256)},
{992, (int)(1.0625*256), (int)(1.00*256)},
{992, (int)(1.125*256), (int)(1.00*256)},
{992, (int)(1.125*256), (int)(1.00*256)},
{992, (int)(1.1875*256), (int)(1.00*256)},
{992, (int)(1.25*256), (int)(1.00*256)},
{992, (int)(1.25*256), (int)(1.00*256)},
{992, (int)(1.3125*256), (int)(1.00*256)},
{992, (int)(1.375*256), (int)(1.00*256)},
{992, (int)(1.4375*256), (int)(1.00*256)},
{992, (int)(1.4375*256), (int)(1.00*256)},
{992, (int)(1.5*256), (int)(1.00*256)},
{992, (int)(1.5625*256), (int)(1.00*256)},
{992, (int)(1.625*256), (int)(1.00*256)},
{992, (int)(1.6875*256), (int)(1.00*256)},
{992, (int)(1.75*256), (int)(1.00*256)},
{992, (int)(1.8125*256), (int)(1.00*256)},
{992, (int)(1.875*256), (int)(1.00*256)},
{992, (int)(1.9375*256), (int)(1.00*256)},
{1488, (int)(1.3125*256), (int)(1.00*256)},
{1488, (int)(1.375*256), (int)(1.00*256)},
{1488, (int)(1.4375*256), (int)(1.00*256)},
{1488, (int)(1.4375*256), (int)(1.00*256)},
{1488, (int)(1.5*256), (int)(1.00*256)},
{1488, (int)(1.5625*256), (int)(1.00*256)},
{1488, (int)(1.625*256), (int)(1.00*256)},
{1488, (int)(1.6875*256), (int)(1.00*256)},
{1488, (int)(1.75*256), (int)(1.00*256)},
{1488, (int)(1.8125*256), (int)(1.00*256)},
{1488, (int)(1.875*256), (int)(1.00*256)},
{1488, (int)(1.9375*256), (int)(1.00*256)},
{1488,	(int)(2.0*256), (int)(1.00*256)},
{1488,	(int)(2.07*256), (int)(1.00*256)},
{1488,	(int)(2.14*256), (int)(1.00*256)},
{1488,	(int)(2.22*256), (int)(1.00*256)},
{1488,	(int)(2.30*256), (int)(1.00*256)},
{1488,	(int)(2.38*256), (int)(1.00*256)},
{1488,	(int)(2.46*256), (int)(1.00*256)},
{1488,	(int)(2.55*256), (int)(1.00*256)},
{1488,	(int)(2.64*256), (int)(1.00*256)},
{1488,	(int)(2.73*256), (int)(1.00*256)},
{1488,	(int)(2.83*256), (int)(1.00*256)},
{1488,	(int)(2.93*256), (int)(1.00*256)},
{1488,	(int)(3.03*256), (int)(1.00*256)},
{1488,	(int)(3.14*256), (int)(1.00*256)},
{1488,	(int)(3.25*256), (int)(1.00*256)},
{1488,	(int)(3.36*256), (int)(1.00*256)},
{1488,	(int)(3.48*256), (int)(1.00*256)},
{1488,	(int)(3.61*256), (int)(1.00*256)},
{1488,	(int)(3.73*256), (int)(1.00*256)},
{1488,	(int)(3.86*256), (int)(1.00*256)},
{1488,	(int)(4.00*256), (int)(1.00*256)},
{1488,	(int)(4.14*256), (int)(1.00*256)},
{1488,	(int)(4.29*256), (int)(1.00*256)},
{1488,	(int)(4.44*256), (int)(1.00*256)},
{1488,	(int)(4.59*256), (int)(1.00*256)},
{1488,	(int)(4.76*256), (int)(1.00*256)},
{1488,	(int)(4.92*256), (int)(1.00*256)},
{1488,	(int)(5.10*256), (int)(1.00*256)},
{1488,	(int)(5.28*256), (int)(1.00*256)},
{1488,	(int)(5.46*256), (int)(1.00*256)},
{1488,	(int)(5.66*256), (int)(1.00*256)},
{1488,	(int)(5.86*256), (int)(1.00*256)},
{1488,	(int)(6.06*256), (int)(1.00*256)},
{1488,	(int)(6.28*256), (int)(1.00*256)},
{1488,	(int)(6.50*256), (int)(1.00*256)},
{1488,	(int)(6.73*256), (int)(1.00*256)},
{1488,	(int)(6.96*256), (int)(1.00*256)},
{1488,	(int)(7.21*256), (int)(1.00*256)},
{1488,	(int)(7.46*256), (int)(1.00*256)},
{1488,	(int)(7.73*256), (int)(1.00*256)},
{1488,	(int)(8.00*256), (int)(1.00*256)},
{1488,	(int)(8.28*256), (int)(1.00*256)},
{1488,	(int)(8.57*256), (int)(1.00*256)},
{1488,	(int)(8.88*256), (int)(1.00*256)},
{1488,	(int)(9.19*256), (int)(1.00*256)},
{1488,	(int)(9.51*256), (int)(1.00*256)},
{1488,	(int)(9.85*256), (int)(1.00*256)},
{1488, (int)(10.20*256), (int)(1.00*256)},
{1488, (int)(10.56*256), (int)(1.00*256)},
{1488, (int)(10.93*256), (int)(1.00*256)},
{1488, (int)(11.31*256), (int)(1.00*256)},
{1488, (int)(11.71*256), (int)(1.00*256)},
{1488, (int)(12.13*256), (int)(1.00*256)},
{1488, (int)(12.55*256), (int)(1.00*256)},
{1488, (int)(13.00*256), (int)(1.00*256)},
{1488, (int)(13.45*256), (int)(1.00*256)},
{1488, (int)(13.93*256), (int)(1.00*256)},
{1488, (int)(14.42*256), (int)(1.00*256)},
{1488, (int)(14.93*256), (int)(1.00*256)},
{1488, (int)(15.45*256), (int)(1.00*256)},
{1488, (int)(16.00*256), (int)(1.00*256)}
};




////////////////////////////////////////////////////////////////////////////////////////////////////////
// FUNCTION IMPLEMENTATION
////////////////////////////////////////////////////////////////////////////////////////////////////////

static INT32S ov5658_sccb_open(void)
{
#if SCCB_MODE == SCCB_GPIO
	ov5658_handle = drv_l2_sccb_open(OV5658_ID, 16, 8);
	if(ov5658_handle == 0) {
		DBG_PRINT("Sccb open fail.\r\n");
		return STATUS_FAIL;
	}
#elif SCCB_MODE == SCCB_HW_I2C
    ov5658_handle.devNumber = I2C_0;
	ov5658_handle.slaveAddr = OV5658_ID;
	ov5658_handle.clkRate = 400;

	//R_FUNPOS1 &= (~MASK_I2C0_TYPE);

//	gpio_init_io(IO_C1, GPIO_OUTPUT);
//	gpio_set_port_attribute(IO_C1, ATTRIBUTE_HIGH);
//	gpio_write_io(IO_C1, DATA_HIGH);

	drv_l1_i2c_init(ov5658_handle.devNumber);
#endif

    DBG_PRINT("I2C open successful\r\n");

	return STATUS_OK;
}

static void ov5658_sccb_close(void)
{
#if SCCB_MODE == SCCB_GPIO
	if(ov5658_handle) {
		drv_l2_sccb_close(ov5658_handle);
		ov5658_handle = NULL;
	}
#elif SCCB_MODE == SCCB_HW_I2C
	drv_l1_i2c_uninit(I2C_0);
	ov5658_handle.slaveAddr = 0;
	ov5658_handle.clkRate = 0;
#endif
}

static INT32S ov5658_sccb_write(INT16U reg, INT8U value)
{
#if SCCB_MODE == SCCB_GPIO
	return drv_l2_sccb_write(ov5658_handle, reg, value);

#elif SCCB_MODE == SCCB_HW_I2C
	INT8U data[3];

	data[0] = (reg >> 8) & 0xFF;
	data[1] = reg & 0xFF;
	data[2] = value;
	return drv_l1_i2c_bus_write(&ov5658_handle, data, 3);
#endif
}



static INT32S ov5658_sccb_read(INT16U reg, INT8U *value)
{
#if SCCB_MODE == SCCB_GPIO
	INT16U data;

	if(drv_l2_sccb_read(ov5658_handle, reg, &data) >= 0) {
		*value = (INT8U)data;
		return STATUS_OK;
	} else {
		*value = 0xFF;
		DBG_PRINT("i2C read fail!\n");
		return STATUS_FAIL;
	}
#elif SCCB_MODE == SCCB_HW_I2C
	INT8U data[2];

	data[0] = (reg >> 8) & 0xFF;
	data[1] = reg & 0xFF;
	if(drv_l1_i2c_bus_write(&ov5658_handle, &data[0], 2) < 0) {
		*value = 0xFF;
		return STATUS_FAIL;
	}

	if(drv_l1_i2c_bus_read(&ov5658_handle, &data[0], 1) < 0) {
		*value = 0xFF;
		return STATUS_FAIL;
	}

	*value = data[0];
#endif
	return STATUS_OK;
}


static INT32S ov5658_sccb_write_table(regval16_t *pTable)
{
	INT8U value;
	INT16U cnt= 0;
	while(1)
	{
		if (pTable->reg_num == 0 && pTable->value == 0) {
			break;
		}
		else if (pTable->reg_num == 0xffff && pTable->value == 0xff) {
			osDelay(5);
			pTable++;
			continue;
		}

		//DBG_PRINT("0x%04x, 0x%02x\r\n", pTable->reg_num, pTable->value);
		if(ov5658_sccb_write(pTable->reg_num, pTable->value) < 0) {
			DBG_PRINT("sccb write fail.\r\n");
			continue;
		}
//	    ov5658_sccb_read(pTable->reg_num, &value);
//    	DBG_PRINT("OV5658 reg addr 0x%x, data 0x%x \r\n", pTable->reg_num, value);

		pTable++;
		cnt++;
		if (cnt == 210){
		DBG_PRINT("OV5658 initial step %d \r\n", cnt);
		}
	}
	return STATUS_OK;
}




static int ov5658_cvt_agc_gain(int agc_gain)
{
	int ov5658_agc_gain, i;

	ov5658_agc_gain = 0;
	i = 5;
	do {
		if(agc_gain <= 0x1f)
			break;

		agc_gain >>= 1;
		ov5658_agc_gain <<= 1;
		ov5658_agc_gain |= 0x10;

		i--;
	} while(i != 0);

	agc_gain -= 0x10;
	if(agc_gain < 0) agc_gain = 0;
	ov5658_agc_gain += agc_gain;

	return ov5658_agc_gain;
}


static unsigned char group_id = 0;
static int ov5658_set_xfps_exposure_time(int ae_ev_step)
{
	unsigned char t1, t2;
	int idx, temp, ret;
	int current_group;
	sensor_exposure_t *si;

    si = &seInfo;
	//DBG_PRINT("%s\n\r", __FUNCTION__);
	#if 1
	si->sensor_ev_idx += ae_ev_step;
	if(si->sensor_ev_idx >= si->max_ev_idx) si->sensor_ev_idx = si->max_ev_idx;
	if(si->sensor_ev_idx < 0) si->sensor_ev_idx = 0;
#if RAW_MODE
	idx = (g_raw_mode_idx < 0) ? si->sensor_ev_idx * 3 : g_raw_mode_idx * 3;
	printk("%s:%d %d\n", __FUNCTION__, __LINE__, g_raw_mode_idx);
#else
	idx = si->sensor_ev_idx * 3;
#endif
	si ->time = p_expTime_table[idx];
	si ->analog_gain = p_expTime_table[idx+1]>>4;
    //DBG_PRINT("[EV=%d, offset=%d]: time = 0x%x, analog gain =0x%x\n\r", si->sensor_ev_idx, ae_ev_step, si->time, si->analog_gain);

    current_group = group_id;
    group_id++;
    group_id = group_id & 0x03;
    ret = ov5658_sccb_write(0x3208, current_group); // Group hold enable
	if(ret < 0) return ret;

	// exposure time
	//if(si ->time != pre_sensor_time)
	{
	//	pre_sensor_time = si->time;
		temp = si->time;

		t1 = (temp & 0x0f) << 4;
        t2 = (temp >> 4) & 0x00ff;
        ret = ov5658_sccb_write(0x3502, t1);
        if(ret < 0) return ret;
        ret = ov5658_sccb_write(0x3501, t2);
        if(ret < 0) return ret;
        t1 =  (temp >> 12) & 0x000f;
        ret = ov5658_sccb_write(0x3500, t1);
        if(ret < 0) return ret;
	}

	//if(si ->analog_gain != pre_sensor_a_gain)
	{	// gain
	//	pre_sensor_a_gain = si->analog_gain;

		temp = si->analog_gain;
//		temp = ov5658_cvt_agc_gain(temp);
		DBG_PRINT(", cvt a gain = 0x%x\r\n", temp);
		t1 = temp & 0x00ff;
        t2 = (temp >> 8) & 0x03;
//m
        // Gain = (0x350A[0]+1) กั (0x350B[7]+1) กั(0x350B[6]+1) กั (0x350B[5]+1) กั(0x350B[4]+1) กั (0x350B[3:0]/16+1)
        ret = ov5658_sccb_write(0x350b, t1);
       if(ret < 0) return ret;
        ret = ov5658_sccb_write(0x350a, t2);
       if(ret < 0) return ret;
    }

    t1 = 0x10 | current_group;
    ret = ov5658_sccb_write(0x3208, t1); //Group latch end
	if(ret < 0) return ret;
	t1 = 0xe0 | current_group;
	ret = ov5658_sccb_write(0x3208, t1); // Group Latch Launch
	if(ret < 0) return ret;

	#endif
	/*
	{
	INT8U value;
	    ov5658_sccb_read(0x3500, &value);
    	DBG_PRINT("OV5658 reg addr 0x3500, data 0x%x \r\n",  value);
    		    ov5658_sccb_read(0x3501, &value);
    	DBG_PRINT("OV5658 reg addr 0x3501, data 0x%x \r\n", value);
    		    ov5658_sccb_read(0x3502, &value);
    	DBG_PRINT("OV5658 reg addr 0x3502, data 0x%x \r\n", value);
    }
    */
	return 0;
}



static void ov5658_set_ae(int ev_step)
{
    ov5658_set_xfps_exposure_time(ev_step);
}


void sensor_register_ae_ctrl(INT32U *handle)
{
    *handle = (INT32U)ov5658_set_ae;
}


void sensor_get_ae_info(sensor_exposure_t *si)
{
    memcpy(si, &seInfo, sizeof(sensor_exposure_t));
}


void sensor_set_max_lum(int max_lum)
{
    seInfo.max_ev_idx = seInfo.total_ev_idx - (64 - max_lum);
}

#ifdef MIPI_ISR_TEST
static void mipi_ov5658_handle(INT32U event)
{
	if(event & MIPI_LANE0_SOT_SYNC_ERR) {
		DBG_PRINT("LANE0_SOT_SYNC_ERR\r\n");
	}

	if(event & MIPI_HD_1BIT_ERR) {
		DBG_PRINT("HD_1BIT_ERR\r\n");
	}

	if(event & MIPI_HD_NBIT_ERR) {
		DBG_PRINT("HD_NBIT_ERR\r\n");
	}

	if(event & MIPI_DATA_CRC_ERR) {
		DBG_PRINT("DATA_CRC_ERR\r\n");
	}

	if(event & MIPI_LANE1_SOT_SYNC_ERR) {
		DBG_PRINT("LANE1_SOT_SYNC_ERR\r\n");
	}

	if(event & MIPI_CCIR_SOF) {
		DBG_PRINT("CCIR_SOF\r\n");
	}
}
#endif


void ov5658_seinfo_init(void)
{
    seInfo.sensor_ev_idx = OV5658_25FPS_60HZ_INIT_EV_IDX;
	seInfo.ae_ev_step = 0;
	seInfo.daylight_ev_idx= OV5658_25FPS_60HZ_DAY_EV_IDX;
	seInfo.night_ev_idx= OV5658_25FPS_60HZ_NIGHT_EV_IDX;
	seInfo.max_ev_idx = OV5658_25FPS_60HZ_MAX_EV_IDX;
	seInfo.total_ev_idx = OV5658_25FPS_60HZ_EXP_TIME_TOTAL;

	p_expTime_table = (int *)ov5658_mipi_25fps_exp_time_gain_60Hz;


	pre_sensor_time = 1;
	pre_sensor_a_gain = 0xff;

	seInfo.time = 1;
	seInfo.analog_gain = 0xff;
	seInfo.digital_gain = 0x00;

    sensor_set_max_lum(g_FavTable.max_lum);
}

/**
 * @brief   initialization function
 * @param   sensor format parameters
 * @return 	none
 */
void ov5658_cdsp_mipi_init(void)
{
    int ret;

	// Turn on LDO 2.8V for CSI sensor
	//drv_l1_power_ldo_28_ctrl(1, LDO_LDO28_2P8V);

    ov5658_seinfo_init();


	// cdsp init
	drv_l2_cdsp_open();

	// set Mclk(CSI_CLKO) to IOD12, for MIPI Mclk
	//R_FUNPOS1 |= ((1<<25)|(1<<22)|(1<<6)|(1<<3)|(1<<2)|(1<<1));//0x02400042;
	R_FUNPOS1 |= ((1<<24)|(1<<21)|(1<<6)|(1<<3)|(1<<2)|(1<<1));//0x02400042;
	//R_FUNPOS1 |= ((1<<24)|(1<<21)|(1<<3)|(1<<2));//0x02400042;


	// mclk output
	//drv_l2_sensor_set_mclkout(ov5658_cdsp_mipi_ops.info[0].mclk);
	drv_l2_sensor_set_mclkout(MCLK_24M);
/*    osDelay(10);

	// Reset
	gpio_set_port_attribute(IO_A14, ATTRIBUTE_HIGH);
	gpio_init_io(IO_A14, GPIO_OUTPUT);
	gpio_write_io(IO_A14, DATA_HIGH);
    osDelay(10);
    gpio_write_io(IO_A14, DATA_LOW);
    osDelay(20);
    gpio_write_io(IO_A14, DATA_HIGH);
    osDelay(10);*/

	// cdsp init
	//drv_l2_cdsp_open();

	// mipi enable
#if (MIPI_DEV_NO == 1)
	drv_l1_mipi_init(MIPI_1,ENABLE);
    //drv_l1_mipi_init(MIPI_1,DISABLE);
#else
    drv_l1_mipi_init(MIPI_0,ENABLE);
    //drv_l1_mipi_init(MIPI_0,DISABLE);
#endif

    DBG_PRINT("Sensor OV5658 cdsp mipi init completed\r\n");
}

/**
 * @brief   un-initialization function
 * @param   sensor format parameters
 * @return 	none
 */
static void ov5658_cdsp_mipi_uninit(void)
{
	// disable mclk
	drv_l2_sensor_set_mclkout(MCLK_NONE);

	// cdsp disable
	//drv_l2_cdsp_close();

	// mipi disable
        #if (MIPI_DEV_NO == 1)
          drv_l1_mipi_init(MIPI_1, DISABLE);
        #else
          drv_l1_mipi_init(MIPI_0, DISABLE);
        #endif

	// release sccb
	ov5658_sccb_close();

	/* Turn off LDO 2.8V for CSI sensor */
	//drv_l1_power_ldo_28_ctrl(0, LDO_LDO28_2P8V);
}

/**
 * @brief   stream start function
 * @param   info index
 *
 * @return 	none
 */
void ov5658_cdsp_mipi_stream_on(INT32U index, INT32U bufA, INT32U bufB)
{
    INT16U R0x30F0, R0x3072, R0x300E;
    int ret;
	INT16U target_w, target_h, sensor_w, sensor_h;
	gpCdspFmt_t format;
    INT16U reg;
    INT8U value;
	// set sensor size
	DBG_PRINT("%s = %d\r\n", __func__, index);
	drv_l2_sensor_set_mclkout(MCLK_24M);


    //Enabel mipi clk, set mipi clk
    drv_l2_mipi_ctrl_set_clk(ENABLE, 2);

	drv_l2_sensor_set_mclkout(ov5658_cdsp_mipi_ops.info[index].mclk);


    // set cdsp format
	format.image_source = C_CDSP_MIPI;
	format.input_format =  ov5658_cdsp_mipi_ops.info[index].input_format;
	format.output_format = ov5658_cdsp_mipi_ops.info[index].output_format;
	target_w = ov5658_cdsp_mipi_ops.info[index].target_w;
	target_h = ov5658_cdsp_mipi_ops.info[index].target_h;
	format.hpixel = sensor_w = ov5658_cdsp_mipi_ops.info[index].sensor_w;
	format.vline = sensor_h = ov5658_cdsp_mipi_ops.info[index].sensor_h;
	format.hoffset = ov5658_cdsp_mipi_ops.info[index].hoffset;
	format.voffset = ov5658_cdsp_mipi_ops.info[index].voffset;
	format.sensor_timing_mode = ov5658_cdsp_mipi_ops.info[index].interface_mode;
	format.sensor_hsync_mode = ov5658_cdsp_mipi_ops.info[index].hsync_active;
	format.sensor_vsync_mode = ov5658_cdsp_mipi_ops.info[index].vsync_active;

    if(drv_l2_cdsp_set_fmt(&format) < 0)
    {
		DBG_PRINT("cdsp set fmt err!!!\r\n");
	}

	// set scale down
	if((sensor_w > target_w) || (sensor_h > target_h)) {
		drv_l2_cdsp_set_yuv_scale(target_w, target_h);
	}



	// set mipi format.
#if 1
    ov5658_mipi_cfg.data_from_mmr = MIPI_AUTO_DETECT;
    ov5658_mipi_cfg.data_type = MIPI_RAW10;
    ov5658_mipi_cfg.h_back_porch = 4;

	ov5658_mipi_cfg.h_size = format.hpixel;
	ov5658_mipi_cfg.v_size = format.vline+format.voffset ;
#endif
	//mipi start
    #if (MIPI_DEV_NO == 1)
      drv_l1_mipi_set_parameter(MIPI_1, &ov5658_mipi_cfg);
      #ifdef MIPI_ISR_TEST
      drv_l1_mipi_set_irq_enable(MIPI_1, ENABLE, MIPI_INT_ALL);
      #endif
    #else
      drv_l1_mipi_set_parameter(MIPI_0, &ov5658_mipi_cfg);
      #ifdef MIPI_ISR_TEST
      drv_l1_mipi_set_irq_enable(MIPI_0, ENABLE, MIPI_INT_ALL);
      #endif
    #endif



    // reguest sccb
	ov5658_sccb_open();
	osDelay(2);

//	gpio_write_io(IO_A12, DATA_HIGH);
//	osDelay(2);


	// init sensor

	ov5658_sccb_write_table((regval16_t *)ov5658_Mipi_Raw10_5M_25fps);
	//ov5658_sccb_write_table((regval16_t *)ov5658_Mipi_Raw10_1080P_30fps);
    reg = 0x4800;
    ov5658_sccb_read((INT16U) reg, &value);
    DBG_PRINT("OV5658 reg addr 0x%x, data 0x%x \r\n", reg, value);
    // reset sensor ev idx
    seInfo.ae_ev_step = 0;
    ov5658_set_xfps_exposure_time(0);

    // cdsp start
	drv_l2_CdspTableRegister((gpCisCali_t *)&g_cali);
	drv_l2_cdsp_stream_on(ENABLE, bufA, bufB);


	drv_l2_cdsp_enable(&g_FavTable, sensor_w, sensor_h, target_w, target_h);


}

/**
 * @brief   stream stop function
 * @param   none
 * @return 	none
 */
static void ov5658_cdsp_mipi_stream_off(void)
{
	//drv_l2_cdsp_stream_off();

	ov5658_sccb_close();
}

/**
 * @brief   get info function
 * @param   none
 * @return 	pointer to sensor information data
 */
static drv_l2_sensor_info_t* ov5658_cdsp_mipi_get_info(INT32U index)
{
	if(index > (MAX_INFO_NUM - 1)) {
		return NULL;
	} else {
		return (drv_l2_sensor_info_t*)&ov5658_cdsp_mipi_ops.info[index];
	}
}


/*********************************************
*	sensor ops declaration
*********************************************/
const drv_l2_sensor_ops_t ov5658_cdsp_mipi_ops =
{
	SENSOR_OV5658_CDSP_MIPI_NAME,		/* sensor name */
	ov5658_cdsp_mipi_init,
	ov5658_cdsp_mipi_uninit,
	ov5658_cdsp_mipi_stream_on,
	ov5658_cdsp_mipi_stream_off,
	ov5658_cdsp_mipi_get_info,
	{
		/* 1st info */
		{
			MCLK_24M,					/* MCLK */
			V4L2_PIX_FMT_SGBRG10,		/* input format */
			V4L2_PIX_FMT_YUYV,			/* output format */
			30,							/* FPS in sensor */
			WIDTH_640,					/* target width */
			HEIGHT_480, 				/* target height */
			OV5658_WIDTH,				/* sensor width */
			OV5658_HEIGHT, 				/* sensor height */
			0,							/* sensor h offset */
			0,							/* sensor v offset */
			MODE_CCIR_601,				/* input interface */
			MODE_NONE_INTERLACE,		/* interlace mode */
			MODE_ACTIVE_HIGH,			/* hsync pin active level */
			MODE_ACTIVE_HIGH,			/* vsync pin active level */
		},
		/* 2st info */
		{
			MCLK_24M,					/* MCLK */
			//V4L2_PIX_FMT_SBGGR10,		/* input format */
			V4L2_PIX_FMT_SGRBG10,		/* input format */
			V4L2_PIX_FMT_YUYV,			/* output format */
			30,							/* FPS in sensor */
			OV5658_OUT_WIDTH,			/* target width */
			OV5658_OUT_HEIGHT, 		/* target height */
			OV5658_WIDTH,				/* sensor width */
			OV5658_HEIGHT, 				/* sensor height */
			4,							/* sensor h offset */
			2,							/* sensor v offset */
			MODE_CCIR_601,				/* input interface */
			MODE_NONE_INTERLACE,		/* interlace mode */
			MODE_ACTIVE_HIGH,			/* hsync pin active level */
			MODE_ACTIVE_HIGH,			/* vsync pin active level */
		},
		/* 3st info */
		{
			MCLK_24M,					/* MCLK */
			V4L2_PIX_FMT_YUYV,			/* input format */
			V4L2_PIX_FMT_YUYV,			/* output format */
			30,							/* FPS in sensor */
			WIDTH_640,					/* target width */
			HEIGHT_480, 				/* target height */
			OV5658_WIDTH,				/* sensor width */
			OV5658_HEIGHT, 				/* sensor height */
			0,							/* sensor h offset */
			0,							/* sensor v offset */
			MODE_CCIR_601,				/* input interface */
			MODE_NONE_INTERLACE,		/* interlace mode */
			MODE_ACTIVE_HIGH,			/* hsync pin active level */
			MODE_ACTIVE_HIGH,			/* vsync pin active level */
		},
		/* 4st info */
		{
			MCLK_24M,					/* MCLK */
			V4L2_PIX_FMT_YUYV,			/* input format */
			V4L2_PIX_FMT_YUYV,			/* output format */
			30,							/* FPS in sensor */
			OV5658_OUT_WIDTH,			/* target width */
			OV5658_OUT_HEIGHT, 			/* target height */
			OV5658_WIDTH,				/* sensor width */
			OV5658_HEIGHT, 				/* sensor height */
			0,							/* sensor h offset */
			0,							/* sensor v offset */
			MODE_CCIR_601,				/* input interface */
			MODE_NONE_INTERLACE,		/* interlace mode */
			MODE_ACTIVE_HIGH,			/* hsync pin active level */
			MODE_ACTIVE_HIGH,			/* vsync pin active level */
		},
	}
};

#endif //(defined _SENSOR_OV5658_CDSP_MIPI) && (_SENSOR_OV5658_CDSP_MIPI == 1)
